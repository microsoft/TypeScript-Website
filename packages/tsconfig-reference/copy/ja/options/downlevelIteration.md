---
display: "Downlevel Iteration"
oneline: "Emit more compliant, but verbose JavaScript for iterating objects"
---

ãƒ€ã‚¦ãƒ³ãƒ¬ãƒ™ãƒ«åŒ–ã¯ã€å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®JavaScriptã«ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã¨ã„ã†æ„å‘³ã®TypeScriptã®ç”¨èªã§ã™ã€‚
ã“ã®ãƒ•ãƒ©ã‚°ã¯ã€ãƒ¢ãƒ€ãƒ³ãªJavaScriptã«ãŠã‘ã‚‹æ–°ã—ã„ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®åå¾©å‡¦ç†ãŒå¤ã„JavaScriptã§ã®å®Ÿè¡Œæ™‚ã«ã©ã®ã‚ˆã†ã«å®Ÿè£…ã•ã‚Œã‚‹ã‹ã«ã¤ã„ã¦ã€ã‚ˆã‚Šæ­£ç¢ºãªã‚µãƒãƒ¼ãƒˆã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚

ECMAScript 6ã§ã¯ã€ã„ãã¤ã‹ã®æ–°ã—ã„åå¾©å‡¦ç†ã®ãŸã‚ã®åŸºæœ¬æ§‹æ–‡ãŒåŠ ãˆã‚‰ã‚Œã¾ã—ãŸ: `for / of`ãƒ«ãƒ¼ãƒ—ï¼ˆ`for (el of arr)`ï¼‰ã€é…åˆ—ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ï¼ˆ`[a, ...b]`ï¼‰ã€å¼•æ•°ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ï¼ˆ`fn(...args)`ï¼‰ã€`Symbol.iterator`ã§ã™ã€‚
`--downlevelIteration`ã¯ã€`Symbol.iterator`ã®å®Ÿè£…ãŒå­˜åœ¨ã—ã¦ã„ã‚‹å ´åˆã€ES5ç’°å¢ƒã«ãŠã‘ã‚‹ã“ã‚Œã‚‰ã®åŸºæœ¬çš„ãªåå¾©å‡¦ç†ã‚’ã‚ˆã‚Šæ­£ç¢ºã«åˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

#### ä¾‹: `for / of`ã§ã®åŠ¹æœ

`downlevelIteration`ãŒç„¡åŠ¹ã§ã‚ã‚‹ã¨ãã€ä»»æ„ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã™ã‚‹`for / of`ãƒ«ãƒ¼ãƒ—ã¯æ—§æ¥ã®`for`ãƒ«ãƒ¼ãƒ—ã¸ãƒ€ã‚¦ãƒ³ãƒ¬ãƒ™ãƒ«ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã•ã‚Œã¾ã™:

```ts twoslash
// @target: ES5
// @showEmit
const str = "Hello!";
for (const s of str) {
  console.log(s);
}
```

ã“ã‚Œã¯å¤§æ¦‚ã®å ´åˆã§æœŸå¾…é€šã‚Šã®çµæœã¨ãªã‚Šã¾ã™ãŒã€ECMAScript 6ã®æŒ™å‹•ã¨100%åˆè‡´ã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ç‰¹å®šã®æ–‡å­—åˆ—ã€ãŸã¨ãˆã°çµµæ–‡å­—ï¼ˆğŸ˜œï¼‰ã¯ã€`.length`ã¯2ï¼ˆã‚‚ã—ãã¯ãã‚Œä»¥ä¸Šï¼ï¼‰ã§ã™ãŒã€`for-of`ãƒ«ãƒ¼ãƒ—ã§ã¯1æ–‡å­—åˆ†ã¨ã—ã¦åå¾©ã•ã‚Œã­ã°ãªã‚Šã¾ã›ã‚“ã€‚
ã‚ˆã‚Šè©³ç´°ãªè§£èª¬ã¯[Jonathan Newã«ã‚ˆã‚‹blog](https://blog.jonnew.com/posts/poo-dot-length-equals-two)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

`downlevelIteration`ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã¨ãã€TypeScriptã¯`Symbol.iterator`ã®å®Ÿè£…ï¼ˆãƒã‚¤ãƒ†ã‚£ãƒ–ã¾ãŸã¯ãƒãƒªãƒ•ã‚£ãƒ«ï¼‰ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚
ã‚‚ã—å®Ÿè£…ãŒå­˜åœ¨ã—ãªã‘ã‚Œã°ã€indexã‚’åˆ©ç”¨ã™ã‚‹åå¾©å‡¦ç†ã¸ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¾ã™ã€‚

```ts twoslash
// @target: ES5
// @downlevelIteration
// @showEmit
const str = "Hello!";
for (const s of str) {
  console.log(s);
}
```

> > **Note:** `Symbol.iterator`ãŒå®Ÿè¡Œæ™‚ã«å­˜åœ¨ã—ãªã„å ´åˆã€`downlevelIteration`ã¯ECMAScriptã¸ã®éµå®ˆã‚’æ”¹å–„ã—ã¾ã›ã‚“ã€‚

#### ä¾‹: é…åˆ—ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã«å¯¾ã™ã‚‹åŠ¹æœ

æ¬¡ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã•ã‚ŒãŸé…åˆ—ã«ã¤ã„ã¦:

```js
// Make a new array who elements are 1 followed by the elements of arr2
const arr = [1, ...arr2];
```

èª¬æ˜ã«æ²¿ã£ã¦ã€æ¬¡ã®ã‚ˆã†ã«ES5ã¸ãƒ€ã‚¦ãƒ³ãƒ¬ãƒ™ãƒ«åŒ–ã§ãã¾ã™:

```js
// The same, right?
const arr = [1].concat(arr2);
```

ã—ã‹ã—ã€ã“ã‚Œã¯ç‰¹å®šã®ç¨€ãªã‚±ãƒ¼ã‚¹ã«ãŠã„ã¦ã¯ã£ãã‚Šã¨ã—ãŸé•ã„ãŒã‚ã‚Šã¾ã™ã€‚
ä¾‹ãˆã°ã€é…åˆ—ã«ã€Œç©´ã€ãŒã‚ã‚‹å ´åˆã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã§ã¯æ¬ è½ã—ãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒ_ç‹¬è‡ªã®_ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦ä½œæˆã•ã‚Œã¾ã™ãŒã€`concat`ã‚’åˆ©ç”¨ã—ãŸå ´åˆã¯ä½œæˆã•ã‚Œã¾ã›ã‚“:

```js
// Make an array where the '1' element is missing
let missing = [0, , 1];
let spreaded = [...missing];
let concated = [].concat(missing);

// true
"1" in spreaded;
// false
"1" in concated;
```

`for / of`ã¨åŒæ§˜ã€`downlevelIteration`ã¯ï¼ˆåˆ©ç”¨å¯èƒ½ã§ã‚ã‚Œã°ï¼‰`Symbol.iterator`ã‚’ä½¿ã„ã€ã‚ˆã‚Šæ­£ç¢ºã«ES6ã®æŒ™å‹•ã‚’æ¨¡å€£ã—ã¾ã™ã€‚
